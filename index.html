<!Doctype HTML>
<html lang=zh-cn>
	<head>
		<meta charset="UTF-8"></meta>
		<style>
			body div{
				text-align:center;
			}
			#myCanvas{
				display:inline-block;
			}
			h1{
				color:blue;
			}
			.btn-box{
				margin-top:20px;
			}
		</style>
	</head>
	<body>
		<div>
			<p><h1>灯具标志图</h1></p>
			
			<canvas id="myCanvas" width="970" height="380" style="border:2px solid #000000;">
				您的浏览器不支持 HTML5 canvas 标签。
			</canvas>
		</div>
		<div class="btm-box">
			<button onClick=rectBorder();>Rect</button>
			<button onClick=arrow();>LeftArrow</button>
			<button onClick=rightArrow();>RightArrow</button>
			<button onClick=b1Sign();>B1</button>
			<button onClick=clear();>Clear</button>
			<button onClick=savectx();>Save</button>
		</div>
		
		<script>
			var c=document.getElementById("myCanvas");
			var ctx=c.getContext("2d");
			ctx.lineWidth=2;
			var num=1;
			//设置倾角15度，然后计算出弧度
			var ang=(15*2*Math.PI)/360;
			//report the mouse position on click
			c.addEventListener("click", 
					function (evt) {
					var mousePos = getMousePos(c, evt);
					//alert(mousePos.x +',' + mousePos.y);
					var x=Math.floor(mousePos.x);
					var y=Math.floor(mousePos.y);
					
					
					ctx.lineWidth=1;
					ctx.moveTo(Math.floor(mousePos.x),Math.floor(mousePos.y))
					
					//确定引线方向
					if((y-190)<0){
						ctx.lineTo((Math.tan(ang)*(y-30)+x),30);
						ctx.lineTo(((Math.tan(ang)*(y-30)+x)+15),30);
						//设置文字，横下上方
						ctx.textBaseline="Bottom";
						ctx.fillText(num,(Math.tan(ang)*(y-30)+x+3),28);
					
					}else{
						ctx.lineTo((Math.tan(ang)*(350-y)+x),353);
						ctx.lineTo(((Math.tan(ang)*(350-y)+x)+15),353);
						//设置文字，横线下方
						ctx.textBaseline="Top";
						ctx.fillText(num,(Math.tan(ang)*(350-y)+x+3),351);
						
						//console.log((Math.tan(ang)*(y-30)+x));
						//console.log((Math.tan(ang)*(y-30)+x)+15);
						
					}
					//console.log(Math.tan(45*2*Math.PI/360));
					//console.log(Math.tan(ang)*(y-30),350);
					num++;
					console.log(Math.floor(mousePos.x),Math.floor(mousePos.y));
					ctx.stroke();
				}
				
			, true);
			

			//Get Mouse Position
            function getMousePos(c, evt) {
			var rect = c.getBoundingClientRect();
			return {
				x: evt.clientX - rect.left * (c.width / rect.width),
				y: evt.clientY - rect.top * (c.height / rect.height)
				}
			}
			
			
			function rectBorder(){
				ctx.rect(40,40,890,300);
			ctx.stroke();
			}
			
			
			function arrow(){
				ctx.moveTo(54,190);
				ctx.lineTo(130,130);
				ctx.lineTo(188,130);
				ctx.lineTo(134,174);
				ctx.lineTo(280,174);
				ctx.lineTo(280,206);
				ctx.lineTo(134,206);
				ctx.lineTo(188,250);
				ctx.lineTo(130,250);
				ctx.lineTo(54,190);
				ctx.stroke();
			}
			function rightArrow(){
				ctx.moveTo(916,190);
				ctx.lineTo(840,130);
				ctx.lineTo(792,130);
				ctx.lineTo(844,174);
				ctx.lineTo(690,174);
				ctx.lineTo(690,206);
				ctx.lineTo(844,206);
				ctx.lineTo(792,250);
				ctx.lineTo(840,250);
				ctx.lineTo(916,190);
				ctx.stroke();
			
			}
			function b1Sign(){
				ctx.moveTo(335,48);
				ctx.lineTo(335,332);
				ctx.lineTo(432,332);
				ctx.lineTo(405,309);
				ctx.lineTo(405,70);
				ctx.lineTo(572,70);
				//小圆弧
				ctx.lineTo(572,232);
				//ctx.beginPath();
				ctx.arc(572,266,17,-0.5*Math.PI,0.5*Math.PI,false);
				
				ctx.lineTo(572,309);
				ctx.lineTo(621,332);
				ctx.lineTo(635,332);
				ctx.lineTo(635,48);
				ctx.lineTo(335,48);
				
				//head
				ctx.moveTo(481,100);
				ctx.arc(461,100,21,0,2*Math.PI);
				
				//body
				ctx.moveTo(405,168);
				ctx.lineTo(427,168);
				ctx.lineTo(458,126);
				ctx.lineTo(535,126);
				ctx.lineTo(560,168);
				ctx.arc(
					(18*Math.sin((2*Math.PI)/360)+560),
					(18*Math.cos((2*Math.PI)/360)+168),
					18,0,
					25*Math.PI*Math.PI,2.25*Math.PI,false
					//这里问题没解决16.1.8
				);
				
				ctx.stroke();
			}
			
			
			function clear(){
				var clr=document.getElementById(myCanvas);
				var cleanr=clr.getContext("2d");
				alert("clear");
				clr.clearRect(10,10,300,300);
				
			}
			
			function savectx(){
				save()
			}
		</script>
		<script src="canvas2Image.js"></script>
	</body>


</html>
